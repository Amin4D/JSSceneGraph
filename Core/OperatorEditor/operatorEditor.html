<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"> 
<html>
  <head>
/*
 *  Copyright 2010-2011 Fabric Technologies Inc. All rights reserved.
 */
  <meta http-equiv="Content-Language" content="en" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>FABRIC Operator Editor</title>
    
    <meta charset="iso-8859-1"/>
    <link href="../../themes/default/style.css" rel="stylesheet" type="text/css" />
    <link href="../../themes/default/viewer.css" rel="stylesheet" type="text/css" />
    
    <script type="text/javascript" src="../../ThirdParty/jQuery/jquery-1.4.2.min.js"></script>
    <script type="text/javascript" src="../../ThirdParty/jQuery/jquery-ui-1.8.5.custom.min.js"></script>

    <link type="text/css" href="../../ThirdParty/jQuery/css/vader/jquery-ui-1.8.5.custom.css" rel="stylesheet" />

    <script type="text/javascript" src="../FABRIC.js" charset="utf-8"></script>
    <script type="text/javascript" src="../FABRIC.Wrappers.js" charset="utf-8"></script>
  
    <link href="prettify.css" type="text/css" rel="stylesheet" />
    <script type="text/javascript" src="prettify.js"></script>
    
    <style type="text/css">
    

#codeContainer{
  position:absolute;
  left:0px;
  right:0px;
  top:0px;
  bottom:55px;
}

#bottomToolbar{
  position:absolute;
  bottom:0;
  right:0;
  left:0;
  height:50px;
  background-color: #222;
  border-left: solid 1px #111;
  }

#code{
  position:absolute;
  left:10px;
  right:10px;
  top:10px;
  bottom:10px;
}

#recompile{
  position:absolute;
  right:10px;
  bottom:10px;
}

  
  </style>
    <script type="text/javascript">

$(document).ready(function() {
  
  if(!window.context){
    var contextID = document.location.search.split('?')[1].split('=')[1];
    window.operatorName = document.location.search.split('?')[2].split('=')[1];
    window.context = FABRIC.createContext({ contextID:contextID  });
  }
  var operator = context.DG.getAllNamedObjects()[operatorName];
  
  $('#recompile').button()
      .click(function() {
        var code = $("#code").val();
        try{
          operator.setSourceCode(code);
        }catch(e){
          alert(e);
        }
          
        descDiags = function(fullCode, diags) {
          var fullCodeLines = fullCode.split('\n');
          var desc = 'Error compiling operator\n';
          for (var i = 0; i < diags.length; ++i) {
            if (i == 16) {
              desc += '(' + (diags.length - i) + ' more diagnostic(s) omitted)\n';
              break;
            }
            desc += diags[i].line + ':' + diags[i].column + ': ' + diags[i].level + ': ' + diags[i].desc + '\n';
            var line = diags[i].line - 1;
            for (var j = line - 6; j <= line + 6; ++j) {
              if (j >= 0 && j < fullCodeLines.length) {
                if (j == line)
                  desc += '>>>\t';
                else
                  desc += '\t';
                desc += '' + fullCodeLines[j] + '\n';
              }
            }
          }
          return desc;
        };

        var diagnostics = operator.getDiagnostics();
        if (diagnostics.length > 0) {
					$( "#compliationErrors" ).text(descDiags(operator.getFullSourceCode(), diagnostics) );
					prettyPrint();
					$( "#compliationErrorDialog" ).dialog( "open" );
        }
      });
  
  $("#code").text(operator.getSourceCode());
  
	$("#compliationErrorDialog").dialog({
			autoOpen: false,
			width: window.innerWidth * 0.75,
			height: window.innerHeight * 0.85,
			modal: true
		});
	
  //prettyPrint()
});


    </script>



  </head> 
  <body>
    <div id="wrapper">
      <ul id="nav">
        <li><a href="#" id="fabric-logo"><img src="../../themes/default/_img/projects/fabric-logo.png" /></a></li>
      </ul>
      <div id="editor">
        
        <div id="codeContainer">
          <textarea id="code" cols="50" rows="5">
          </textarea>
<!--
<pre class="prettyprint">
// Some source code
class Foo
{
   public int Bar { get; set; }
}
</pre>
-->
        </div><!--code-->
        
        <div id="bottomToolbar">
                 <button id="recompile" style="margin-top:10px;">Recompile</button>
        </div><!--bottomToolbar-->
				
      </div> <!--editor-->
    </div><!--wrapper-->
		
		<div id="compliationErrorDialog" title="Compilation Error">
			<pre id="compliationErrors" class="prettyprint"></pre>
<!--
			<p id="compliationErrors" class="content">This is the default dialog which is useful for displaying information. The dialog window can be moved, resized and closed with the 'x' icon.</p>
-->
		</div>

  </body> 
</html>
